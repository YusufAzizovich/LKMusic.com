<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>LKPaint —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –ø–∏–ø–µ—Ç–∫–æ–π</title>
<style>
body { background: #161616; color: white; font-family: Arial, sans-serif; text-align: center; margin: 0; padding: 10px; }
h1 { margin-bottom: 20px; }

.controls { display: flex; flex-wrap: wrap; justify-content: center; gap: 5px; margin-bottom: 10px; }
.tool-group button { font-size: 18px; cursor: pointer; padding: 5px 8px; background: #222; border: 1px solid #444; color: white; border-radius: 5px; }
.tool-group button.active { border: 2px solid #0f0; }
input[type="color"], input[type="range"], button, select { margin: 5px; }
canvas { background: white; border: 2px solid #444; display: block; margin: 0 auto; touch-action: none; cursor: crosshair; }
#brushList { display: flex; flex-wrap: wrap; justify-content: center; gap: 5px; margin-top: 5px; }
#brushList img { width: 40px; height: 40px; cursor: pointer; border: 2px solid #444; border-radius: 5px; }
#brushList img.selected { border: 2px solid #0f0; }

#magnifier {
    position: absolute;
    width: 120px;
    height: 120px;
    border: 2px solid #0f0;
    border-radius: 50%;
    pointer-events: none;
    display: none;
    z-index: 9999;
    background: #111;
}
#magnifier span {
    position: absolute;
    bottom: 2px;
    left: 2px;
    color: white;
    font-size: 12px;
    background: rgba(0,0,0,0.5);
    padding: 2px 4px;
    border-radius: 3px;
}
</style>
</head>
<body>

<h1>LKPaint —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –ø–∏–ø–µ—Ç–∫–æ–π</h1>

<div class="controls">
    <div class="tool-group">
        <button data-tool="brush" class="tool active">!</button>
        <button data-tool="pencil" class="tool">‚úèÔ∏è</button>
        <button data-tool="spray" class="tool">üí®</button>
        <button data-tool="eraser" class="tool">ü©π</button>
        <button data-tool="line" class="tool">üìè</button>
        <button data-tool="rect" class="tool">‚¨õ</button>
        <button data-tool="circle" class="tool">‚ö™</button>
        <button data-tool="triangle" class="tool">üî∫</button>
        <button data-tool="fill" class="tool">^</button>
        <button data-tool="text" class="tool">üî§</button>
        <button data-tool="eyedropper" class="tool">üéØ</button>
    </div>

    <label>–¶–≤–µ—Ç: <input type="color" id="colorPicker" value="#000000"></label>
    <label>–¢–æ–ª—â–∏–Ω–∞: <input type="range" id="sizePicker" min="1" max="50" value="5"></label>
    <label>–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å: <input type="range" id="opacityPicker" min="0" max="1" step="0.05" value="1"></label>
    <button id="undoBtn">‚Ü©Ô∏è Undo</button>
    <button id="redoBtn">‚Ü™Ô∏è Redo</button>
    <button id="clearBtn">üßπ –û—á–∏—Å—Ç–∏—Ç—å</button>
    <button id="saveBtn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
</div>

<div id="brushList"></div>
<canvas id="paintCanvas"></canvas>
<canvas id="magnifier"><span id="magnifierColor"></span></canvas>

<script>
const canvas = document.getElementById('paintCanvas');
const ctx = canvas.getContext('2d');
const magnifier = document.getElementById('magnifier');
const magnifierColor = document.getElementById('magnifierColor');

let currentTool='brush', drawing=false;
let startX, startY, brushOpacity=1;

// --- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ ---
function setCanvasSize(){
    const w=window.innerWidth*0.8;
    const h=window.innerHeight*0.7;
    canvas.width=w; canvas.height=h;
}
setCanvasSize();
window.addEventListener('resize', setCanvasSize);

// --- –ü–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ ---
const colorPicker = document.getElementById('colorPicker');
const sizePicker = document.getElementById('sizePicker');
const opacityPicker = document.getElementById('opacityPicker');
const undoBtn = document.getElementById('undoBtn');
const redoBtn = document.getElementById('redoBtn');
const clearBtn = document.getElementById('clearBtn');
const saveBtn = document.getElementById('saveBtn');

document.querySelectorAll('.tool-group button').forEach(btn=>{
    btn.addEventListener('click', ()=>{
        document.querySelectorAll('.tool-group button').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        currentTool=btn.dataset.tool;
    });
});

opacityPicker.addEventListener('input', e=>brushOpacity=parseFloat(e.target.value));

// --- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã ---
function getPos(e){
    if(e.touches){ const rect=canvas.getBoundingClientRect(); return {x:e.touches[0].clientX-rect.left, y:e.touches[0].clientY-rect.top}; }
    else return {x:e.offsetX, y:e.offsetY};
}

// --- –†–∏—Å–æ–≤–∞–Ω–∏–µ ---
canvas.addEventListener('mousedown', e=>{
    const pos=getPos(e); startX=pos.x; startY=pos.y;
    if(currentTool==='eyedropper'){ showMagnifier(pos.x,pos.y); return; }
    drawing=true;
});
canvas.addEventListener('mouseup', e=>{
    drawing=false; hideMagnifier();
});
canvas.addEventListener('mousemove', e=>{
    const pos=getPos(e);
    if(currentTool==='eyedropper' && drawing){ showMagnifier(pos.x,pos.y); }
    if(!drawing) return;
    ctx.lineCap='round';
    ctx.lineWidth=currentTool==='pencil'?1:sizePicker.value;
    ctx.globalAlpha=brushOpacity;
    if(currentTool==='brush'){ ctx.lineTo(pos.x,pos.y); ctx.strokeStyle=colorPicker.value; ctx.stroke(); ctx.beginPath(); ctx.moveTo(pos.x,pos.y); }
});

// --- –û—á–∏—Å—Ç–∫–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ ---
clearBtn.addEventListener('click', ()=>ctx.clearRect(0,0,canvas.width,canvas.height));
saveBtn.addEventListener('click', ()=>{ const link=document.createElement('a'); link.download='painting.png'; link.href=canvas.toDataURL(); link.click(); });

// --- –õ—É–ø–∞ –¥–ª—è –ø–∏–ø–µ—Ç–∫–∏ ---
const magnifierSize=120, magnification=10;
function showMagnifier(x,y){
    magnifier.style.display='block';
    magnifier.style.left = (x+20)+'px';
    magnifier.style.top = (y+20)+'px';
    const halfSize = magnifierSize/(2*magnification);
    const sx = Math.max(0, Math.min(canvas.width-2*halfSize, x-halfSize));
    const sy = Math.max(0, Math.min(canvas.height-2*halfSize, y-halfSize));
    const mCtx = magnifier.getContext('2d');
    mCtx.clearRect(0,0,magnifierSize,magnifierSize);
    mCtx.imageSmoothingEnabled=false;
    mCtx.drawImage(canvas,sx,sy,2*halfSize,2*halfSize,0,0,magnifierSize,magnifierSize);
    mCtx.strokeStyle='red';
    mCtx.lineWidth=1;
    mCtx.beginPath();
    mCtx.moveTo(magnifierSize/2,0); mCtx.lineTo(magnifierSize/2,magnifierSize);
    mCtx.moveTo(0,magnifierSize/2); mCtx.lineTo(magnifierSize,magnifierSize/2);
    mCtx.stroke();
    const centerData = ctx.getImageData(x,y,1,1).data;
    magnifierColor.textContent = `#${((1<<24)+(centerData[0]<<16)+(centerData[1]<<8)+centerData[2]).toString(16).slice(1)} rgb(${centerData[0]},${centerData[1]},${centerData[2]})`;
}

function hideMagnifier(){ magnifier.style.display='none'; }

// –í—ã–±–æ—Ä —Ü–≤–µ—Ç–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –ø–∏–ø–µ—Ç–∫–æ–π
canvas.addEventListener('mousedown', e=>{
    if(currentTool!=='eyedropper') return;
    const pos=getPos(e);
    const data=ctx.getImageData(pos.x,pos.y,1,1).data;
    colorPicker.value = '#' + ((1 << 24) + (data[0]<<16) + (data[1]<<8) + data[2]).toString(16).slice(1);
});
</script>

</body>
</html>

